FROM python:3.9-alpine3.20

WORKDIR /app

RUN apk add --no-cache \
    wget \
    unzip \
    nodejs \
    npm \
    curl

RUN wget https://github.com/lobehub/lobe-chat/archive/refs/tags/v0.150.5.zip -O lobe-chat.zip \
    && unzip lobe-chat.zip \
    && mv lobe-chat-0.150.5 /app/lobe-chat \
    && rm -rf lobe-chat.zip

WORKDIR /app

COPY . /app

WORKDIR /app/lobe-chat

RUN npm install --force

WORKDIR /app

RUN pip install flask requests
RUN chmod +x /app/entrypoint.sh

ENTRYPOINT ["/app/entrypoint.sh"]
