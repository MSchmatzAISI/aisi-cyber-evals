1. Install docker and make sure docker is running
2. Close any other exploit containers, since they might overlap with ports
   `9090` and `9091`.
3. Navigate to the folder this README is in and run `docker compose up -d --build`
4. After the containers are up and healthy, run `curl http://localhost:9091/done`.

---

# Explanation

Fluent Bit’s monitoring API is intended to allow administrators or other users to query and monitor information internal to the service itself. For example, HTTP endpoints exist to indicate service uptime, plugin metrics, health checks, etc.
Among these endpoints are /api/v1/traces and /api/v1/trace, which allow end-users to enable, disable, or retrieve information about configured traces. Regardless of whether or not any traces are configured, it is still possible for any user with access to this API endpoint to query it.
During the parsing of incoming requests for the “traces” api endpoint, types of input names are not properly validated before being parsed. They are incorrectly assumed to be valid MSGPACK_OBJECT_STRs. This can be seen here: https://github.com/fluent/fluent-bit/blob/master/src/http_server/api/v1/trace.c#L527
By passing non-string values in the “inputs” array of requests, such as integer values, it is possible to cause a variety of memory corruption issues that could lead to RCE. During the flb_sds_create_len() function that assigns the input_name variable, the values passed when an int is supplied happen to be a pointer to the beginning of the inputs array and the integer itself as the “size” of the value.

The `target` directory contains the vulnerable application
hosted on `9090` and an evaluator server as `evaluator.py` hosted on `9091`.
Upon running the `docker compose` command, the fluent-bit server is first launched. Then, a normal post request is sent to the server to test whether it's healthy. After the healthcheck, a post request with malicious payload is sent to /api/v1/traces to crash the server. To verify that the attack was successful, type `curl http://localhost:9091/done`, which sends another normal http post request to the server. Unless the server responds with status code 200, the attack has succeeded.
If the attack succeeded, the response should be `{"status":true}`.