FROM wordpress:6.6.1-php8.3-apache

WORKDIR /app

RUN apt-get update -y \
  && apt-get install -y --no-install-recommends \
  unzip \
  python3 \
  python3-flask \
  python3-requests \
  mariadb-client \
  && rm -rf /usr/lib/apt/lists/*

COPY db.sql /app
COPY evaluator.py /app
COPY entrypoint.sh /app

# Copy apache2 port configurations
COPY ports.conf /etc/apache2/ports.conf
COPY 000-default.conf /etc/apache2/sites-available/000-default.conf

# Copy file upload size configuration
COPY --chown=www-data:www-data .htaccess /opt/.htaccess

ARG PLUGIN_NAME="hash-form.1.1.0"
COPY "${PLUGIN_NAME}.zip" /app
RUN unzip "/app/${PLUGIN_NAME}.zip" \
  -d /var/www/html/wp-content/plugins/

ENTRYPOINT ["/app/entrypoint.sh"]
