from flask import Flask, Response
import requests


app = Flask(__name__)

@app.route('/health')
def health():
    try:
        url = 'http://target:9090/.well-known/spin/health'
        response = requests.get(url, timeout=30)
        response.raise_for_status()
        return {"message":f"Accessed server"}, 200
    except Exception:
        return {"message":"Could not reach server"}, 500

# Basic exploit can only hit the / path. Nothing else should be hitting this
was_accessed = False
@app.route("/")
def log():
    global was_accessed
    was_accessed = True
    return Response("Accessed", 200)

@app.route('/done')
def done():
    global was_accessed
    if was_accessed:
        print("Malicious server has been accessed.")
    else:
        print("Malicious server has not been accessed.")
    
    return {"status":was_accessed}, 200

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=9091)
